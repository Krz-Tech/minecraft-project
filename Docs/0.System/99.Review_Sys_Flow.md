ファイル：`Docs/0.System/99.Review_Sys_Flow.md`
更新日時：`2025/12/30 01:15`

# 開発・デプロイメントフロー レビュー

`Docs/0.System/0.Sys_Flow.md` で定義された新たな開発・デプロイメントフロー（Dual Directory & Branch Strategy）に対する技術的レビューを行います。

## 1. 総合評価
**安全性と安定性を最優先した堅牢な設計**です。
開発中の実験的なコードが本番環境に混入するリスクを物理的（ディレクトリ分割）および論理的（ブランチ分割）の二重のレイヤーで遮断しており、個人開発規模から小規模チーム開発への拡張にも十分耐えうる構成です。

## 2. メリット (Good)

### A. 事故防止機構 (Fail-Safe)
ArgoCDのSyncトリガーを「`production` ブランチ **かつ** `production/` ディレクトリ」に限定した点は非常に強力です。
仮に `develop` ブランチでの作業中に誤って `production` タグをつけてしまったり、マージ設定を間違えたとしても、ファイル自体が `develop/` ディレクトリにある限り、本番環境のArgoCDは無視するため、意図しないデプロイが発生しません。

### B. 明確なステージング
`develop/` ディレクトリがあることで、リポジトリ内において「現在開発中の機能」と「現在稼働中の機能」が一目瞭然になります。これはSkriptのようなファイルベースのアプリケーションにおいて、Diffの確認以上に直感的な管理を可能にします。

## 3. 懸念点と対策 (Concerns & Mitigations)

### A. ファイル移動の手間 (Friction)
**課題**: `develop` から `production` へのリリース（PR）時に、単なるマージではなく「ファイルの移動（`git mv develop/xxx.sk production/xxx.sk`）」が必要になります。これは手動で行うと忘れやすく、コンフリクトの原因になりやすいです。
**推奨対策**: GitHub Actionsを活用した自動化。
*   PRマージ時、あるいはPR作成時に `production/` へのファイル移動を自動検知あるいは提案するスクリプトを導入する。
*   または、リリース専用のスクリプト（`./repo promote <feature>`）を用意し、内部で `git mv` を実行させる。

### B. Git履歴の追跡
**課題**: ファイルを移動すると、Gitクライアントによっては履歴の追跡（History Following）が途切れたように見える場合があります（特に大幅な変更と移動を同時に行った場合）。
**推奨対策**: 移動は移動のみで1コミットとし、コード変更と同時のコミットを避ける運用ルールを設けることで、Gitがリネームを正しく認識しやすくなります。

## 4. 今後の推奨アクション

1.  **CIによる制約の実装**:
    *   `production` ブランチに対して、`develop/` ディレクトリへの変更を含むコミットを禁止する（CIでFailさせる）設定を追加し、ルールを強制力のあるものにする。
2.  **プロモーションフローの整備**:
    *   開発完了したSkriptを `develop/` から `production/` へ昇格させる際の手順書、または自動化ツールの開発。

概要として、リリースの手間（ファイルの移動作業）というコストと引き換えに、極めて高い安全性（Deployment Safety）を手に入れたトレードオフ設計と言えます。本番環境の安定稼働を重視する本プロジェクトにおいては**適切な選択**です。
