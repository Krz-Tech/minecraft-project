# 戦闘支援システム：スマートエイム (Combat Support: Smart Aim)

## 概要
3人称視点での射撃・近接戦闘を補佐し、快適なアクション体験を提供するための「火器管制システム (FCS)」の総称です。
プレイヤーのスキルや反射神経だけに依存せず、装備（FCSチップ）による「捕捉能力」が勝敗を左右します。

---

## 1. ロックオン・システム (Target Lock-on)
画面中央付近の敵を検出し、追従する基礎システムです。

### 仕様 (Specifications)
*   **捕捉範囲**: レティクル（画面中央）を中心とした円形範囲 (FCSの捕捉角に依存)。
*   **捕捉距離**: 10m〜100m (FCSの性能に依存)。
*   **捕捉プロセス**:
    1.  範囲内に対象を捉え続けると「捕捉ゲージ」が蓄積。
    2.  ゲージが最大になると **[LOCK-ON]** 状態に移行。
*   **UI表示 (Private HUD)**: 
    *   ロックオン対象の頭上に、**自分にのみ見える** Text Display マーカーを表示。
    *   マーカーには対象の距離や簡易的なステータス（ランク等）を表示可能。
    *   ActionBarに `LOCKING...` または `LOCKED` を表示。

---

## 2. 追従射撃アシスト (Homing/Tracking)
ロックオン済みの対象に対して、弾道を補正する機能です。

### 仕様 (Specifications)
*   **弾道カーブ**: 発射された遠距離攻撃アイテム（雪玉、矢、またはカスタムエンティティ）のベクトルを、毎tickごとに対象の方向へわずかに修正します。
*   **補正精度**:
    *   対象がレティクルに近いほど強力。
    *   対象が急激に回避行動（アサルトダッシュ等）をとると、補正が追いつかず外れる設計にします（回避の価値を維持）。

---

## 3. 近接踏み込みアシスト (Melee Step-in)
近接攻撃時に、対象との距離を自動で詰める機能です。

### 仕様 (Specifications)
*   **発動条件**: ロックオン中に攻撃（左クリック）を行う。
*   **効果**: 
    *   対象との距離が3〜5m以内の場合、対象の方向へ瞬間的に微小なベクトル加算（踏み込み）を行います。
    *   これにより、「空振り」を減らし、スピード感のある近接戦を実現します。

---

## 4. FCSステータスによる変化 (FCS Scaling)

| パラメータ | 影響するステータス | 説明 |
|-----------|------------------|------|
| **捕捉角 (Angle)** | Wide/Narrow FCS | 画面のどの程度広い範囲をサーチするか。 |
| **ロック速度** | Quick Lock FCS | ゲージが溜まるまでの秒数。 |
| **最大ロック距離** | Long Range FCS | 遠くの敵を捕捉できる限界。 |
| **同時ロック数** | Multi Lock FCS | (将来拡張) 複数の敵を同時に捕捉可能か。 |

---

## 5. 技術メモ (Technical Notes)

*   **捕捉判定**: `raytrace` を使用せず、プレイヤーの視線ベクトルと対象エンティティへのベクトルの「内積」で角度を計算します（負荷軽減）。
*   **弾道補正**: Skript の `set velocity of projectile to vector from projectile to target` ではなく、緩やかにベクトルを合成 (Lerp) する方法を採用します。
*   **負荷対策**: `every 2 ticks` でロック判定を行い、全プレイヤーの毎tick計算は避けます。

---

*最終更新: 2025-12-23*
