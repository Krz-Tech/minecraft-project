---
作成日時: 2025-12-23
更新日時: 2025-12-23
作成者: Antigravity (AIエージェント)
---

# BossBar 仕様書 (TAB & PlaceholderAPI 連携)

本ドキュメントでは、外部プラグイン **TAB** を用いた、Skript主導のBossBar表示システムの詳細仕様を定義します。

---

## 1. コンセプト (Concept)
- **Skript主導**: 表示内容のロジック（タイマー、色、進行度）はすべて Skript 側で計算。
- **軽量更新**: Skript側では変数をセットするだけで、BossBarの表示・パケット送信は TAB が一括管理。
- **条件付き表示**: 不要なタイミングでは自動的に非表示にする制御を TAB 側で設定。

---

## 2. PAPI プレースホルダーの定義 (Placeholders)

Skript で値を保持し、PlaceholderAPI を介して TAB に渡す変数の命名規則です。

| プレースホルダー (PAPI名) | Skript変数名 | 用途 | 例 |
| :--- | :--- | :--- | :--- |
| `%skript_krz_bb_text%` | `{-kp::%player%::bb::text}` | BossBarの中央テキスト | `&f帰還可能まで: &b残り 350m` |
| `%skript_krz_bb_progress%`| `{-kp::%player%::bb::progress%}`| 0.0 ~ 100.0 の数値 | `75` |
| `%skript_krz_bb_color%` | `{-kp::%player%::bb::color}` | バーの色 (TAB用) | `BLUE`, `RED`, `GREEN` |
| `%skript_krz_bb_style%` | `{-kp::%player%::bb::style}` | 分割数 (NOTCHED_10等) | `PROGRESS` |

---

## 3. TAB 構成設定 (TAB Configuration)

`plugins/TAB/config.yml` における設定例です。

```yaml
bossbars:
  krz-playground-hud:
    # プレイグラウンド、またはHUDが必要な条件の時のみ表示
    display-condition: "%world% == playground"
    text: "%skript_krz_bb_text%"
    progress: "%skript_krz_bb_progress%"
    color: "%skript_krz_bb_color%"
    style: "%skript_krz_bb_style%"
    refresh: 100 # 更新間隔 (ms)
```

---

## 4. Skript 実装例 (Skript Implementation)

Skript 側での制御方法です。

```skript
# BossBarの更新用関数
function ui_update_bossbar(p: player, text: text, progress: number, color: text = "BLUE"):
    set {-kp::%{_p}%::bb::text} to {_text}
    set {-kp::%{_p}%::bb::progress} to {_progress}
    set {-kp::%{_p}%::bb::color} to {_color}
    set {-kp::%{_p}%::bb::style} to "PROGRESS"

# 帰還タイマーの例
every 1 second in "playground":
    loop all players in world "playground":
        set {_time} to pg_get_remaining_time(loop-player)
        set {_progress} to pg_get_extraction_percentage(loop-player)
        
        if {_time} < 60:
            set {_color} to "RED"
        else:
            set {_color} to "BLUE"
            
        ui_update_bossbar(loop-player, "&f帰還まで: &b%{_time}%s", {_progress}, {_color})
```

---

## 5. メリットと注意点 (Benefits & Notes)

- **メリット**: 
  - コマンド連打によるログ肥大化やパフォーマンス低下を防げる。
  - TABの「高度な条件判断」を利用して、ログイン直後や特定のGUIを開いている時に非表示にするなどの微調整が容易。
- **注意点**: 
  - PlaceholderAPI の Skript 拡張が導入されている必要があります。
  - PAPIのプレースホルダー名は、Skript内で登録した名前に合わせる必要があります。

---
### 付録: 編集者情報
**エージェント名**: Antigravity (Google Deepmind)
**実施作業**: TABとSkript(PAPI)を連携させたBossBar仕様の作成。
**コンテキスト**: 外部プラグインを活用した保守性の高いHUDシステムの構築。
